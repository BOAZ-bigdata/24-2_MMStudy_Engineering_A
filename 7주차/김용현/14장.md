# 14장 스트림 처리

## 14.1 스트림 처리란 무엇인가?
데이터 스트림이란 **무한히 늘어나는 데이터세트를 추상화한 것**이다

이벤트 스트림에는 다음과 같은 특징이 있다.
- 순서가 존재한다.
- 데이터 레코드는 불변하다.
- 재생이 가능하다.
- 요청-응답
- 배치처리
- 스트림 처리

## 14.3 스트림 처리 디자인 패턴
### 14.3.1 단일 이벤트 처리
각각의 이벤트를 개별적으로 처리하는 패턴 각각의 이벤트가 독립적으로 처리되어 장애 복구나 부하 분산이 매우 쉽다는 장점이 있다.

### 14.3.2 로컬 상태와 스트림 처리
여러 개의 애플리케이션 인스턴스를 두고 각 인스턴스별로 한 토픽에서 메시지를 수신하여 데이터를 처리하는 경우도 있다. 이 때는 애플리케이션에 스트림 상태를 저장할 수 있는데 이를 로컬에 저장하여 사용한다. 이 경우 고려해야할 것들은 주로 다음과 같다.

- 메모리 사용
- 영속성
  - 서버 노드가 다운될 시 로컬에 저장된 데이터가 날아갈 수도 있기 때문에 디스크에 데이터를 영속화한다. 
- 리밸런싱

### 14.3.4 외부 검색을 사용하는 처리: 스트림-테이블 조인
스트림 데이터 처리 도중 외부 데이터베이스와의 조인이 필요한 경우 데이터베이스와 스트림 간의 성능 차이와 지연 등의 이유로 인해 이러한 패턴은 비효율적이다.

이에 데이터베이스의 변경 내역을 이벤트 스트림으로 받아오는 CDC를 수행하여 데이터베이스 변경 이벤트가 발생할 때마다 알림을 받아 테이블 복사본을 업데이트 하는 또 하나의 인스턴스를 만든다.

이렇게 되면 스트림 과정에 외부 데이터베이스는 필요가 없기 때문에 성능과 가용성을 모두 챙길 수 있다.

### 14.3.6 스트리밍 조인
테이블과 스트림 간 말고도 스트림과 스트림 간의 조인이 필요한 경우도 있다. 이 경우 보통 같은 시간 윈도우에 발생한 이벤트에 대해서 조인을 진행한다.

## 14.5 카프카 스트림즈: 아키텍처 개요
### 14.5.1 토폴로지 생성하기
모든 스트림즈 애플리케이션은 하나의 토폴로지를 구성하고 실행한다. DAG(Directed acyclic graph)로도 불린다.

### 14.5.4 토폴로지 규모 확장하기
태스크는 하나의 스레드에 의해 실행된다. 토폴로지를 확장하기 위해서는 본질적으로 스레드 수를 늘려야 한다. 그러기 위해서는 서버 인스턴스가 추가로 필요할 수도 있다. 이러한 방식으로 토폴로지를 확장해나가면 된다.
# 13장 카프카 모니터링하기

### 13.1.1 지표는 어디에 있는가?
- 애플리케이션 지표
- 로그
- 인프라스트럭쳐 지표
- 특수 클라이언트 지표
- 일반 클라이언트 지표

### 지표 수집 시 고민할 점
#### 경보냐, 디버깅이냐
문제 발생 시 경보가 목적이라면, 짧은 간격을 기록한 지표가 더 유리할 때가 있다. 반대로 디버깅이 목적이라면 일정 시간 동안 계속해서 모은 지표 데이터들이 유용할 때가 많다.

필요한 상황에 따라 적절한 지표를 수집하고 분석해야 한다.

#### 자동화가 목적인지, 사람이 볼 것인지
지표를 이용해 무엇인가 자동화를 수행하는 것이라면 대량의 데이터들을 수집해도 상관 없다. 그러나 사람이 문제 발생 시 경보를 받는데, 이것이 시도 때도 없이 일어난다면 경보 피로감에 빠질 수 있다.

지표 별로 경보가 나갈 문턱 값을 적절히 정의하고 항상 최싄으로 유지하는 것이 중요하다.

### 13.2.3 경보에 SLO 사용하기
SLO는 주된 정보로 설정되어 있어야 한다. SLO는 사용자의 관점에서 문제를 기술하는 것이고, 운영하는 사람 입장에서는 가장 먼저 고려해야 하기 때문이다.

그러나 이러한 SLO를 직접적인 경보 수준에 넣는 것은 어렵다. SLO는 장기간을 기준으로 할 때 가장 좋은데, 이를 경보에 넣으면 이미 경보가 발생했을 땐 늦었기 때문이다.

따라서 소진율을 보는 것이 좋은데, 소진율은 실패한 횟수라고 보면 된다.

### 13.3.1 클러스터 문제 진단하기
- 단일 브로커에서 발생하는 문제
- 과적재된 클러스터에서 발생하는 문제
- 컨트롤러 문제

#### 요청 핸들러 유휴 비율
요청 핸들러가 쉬고 있는 비율을 나타낸 지표로, 이 값이 낮을 수록 요청 핸들링에 과부하가 걸린다는 의미이다. 이를 해결하기 위해 요청 핸들러 스레드를 많이 만들면 좋을 것 같지만 실제로는, 브로커의 CPU 개수보다 많은 스레드를 설정할 필요는 없다.

경험적으로 유휴 비율이 20프로 이하면 잠재적인 문제, 10프로 이하면 성능 문제가 발생하고 있다고 보면 된다.

### 요청 지표
최소한 모든 유형의 요청에 대해 초당 요청 수 지표, 전체 시간 지표의 평균값과 높은 백분위수 중 하나는 수집해야 한다.  
이는 카프카 브로커의 성능에 대한 전체적인 모습을 보여준다.


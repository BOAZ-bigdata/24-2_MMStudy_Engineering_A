# 11장 보안

## 11.1 보안 설정 적용하기
카프카의 보안 절차는 다음과 같다.
- 인증은 사용자가 누구인지 식별한다.
- 인가는 사용자가 무엇을 할 수 있는지 결정한다
- 암호화는 누설과 위조로부터 데이터를 보호한다.
- 감사는 사용자가 무엇을 했는지, 하려 했는지 추적한다.
- 쿼터는 자원을 얼마나 많이 사용할 수 있는지를 조절한다.

## 11.2 보안 프로토콜

### PLAINTEXT
인증이 존재하지 않음. 인증이 필요없는 민감하지 않은 데이터 처리 시 사용

### SSL
선택적으로 클라이언트 SSL 인증 수행 가능.

### SASL_PLAINTEXT
SASL 인증과 PLAINTEXT 전송 계층이 합쳐진 것

> **참고**  
> SSL은 공개키 암호화를 사용한 통신 프로토콜로, 종단 사이에 교환되는 메시지를 안전하게 보호하는 것을 목표로 한다.  
> 
> SASL은 종단 간에 사용할 인증 방식을 서로 합의할 수 있도록 해주는 프레임워크다.

### 11.3.2 SASL
SASL 인증은 서버가 챌린지를 내놓으면 클라이언트가 여기에 응답을 보내는 과정을 일정한 순서로 수행하는 식으로 수행된다.

#### SASL/GSSAPI
케르베로스는 널리 사용되는 네트워크 인증 프로토콜로서, 불완전한 네트워크에서의 안전한 상호 인증을 구현하기 위해 강력한 암호화 기능을 이용한다.

#### SASL/SCRAM
암호화되지 않은 비밀번호가 전송되는 것을 피하고 악의적인 사용자가 다른 사용자로 가장해서 내용을 읽어오는 것이 불가능한 형식으로 저장한다.

#### SASL/OAUTHBEARER
Oauth 2.0으로 얻은 자격 증명을 이용하여 비 http 프로토콜로 보호된 자원에 접근할 수 있게 해준다. 

## 11.4 암호화
종단 암호화가 설정된 상황에서 카프카의 데이터 흐름은 다음과 같다.
1. 카프카 프로듀서를 사용해서 메시지를 보낸다.
2. 프로듀서가 KMS에 저장된 암호화 키를 사용해서 메시지를 암호화한다.
3. 암호화된 메시지가 브로커로 전달된다. 브로커는 암호화된 메시지를 파티션 로그에 저장한다.
4. 브로커가 암호화된 메시지를 컨슈머로 보낸다.
5. 컨슈머가 KMS에 저장된 암호화 키를 사용해서 메시지를 복호화한다.

